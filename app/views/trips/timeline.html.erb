<% content_for :title, "#{@trip.name} - Timeline" %>
<% content_for :header do %>
  <%= render "header_with_tabs" %>
<% end %>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="bg-white rounded-lg shadow">
    <div class="px-4 py-5 sm:p-6">
      <div class="mb-6">
        <h2 class="text-lg font-medium text-gray-900">Trip Timeline</h2>
        <p class="mt-1 text-sm text-gray-600">View your trip events across the entire duration</p>
      </div>

      <!-- Timeline Container -->
      <div class="mb-8">
        <div class="relative">
          <!-- Timeline Header -->
          <div class="flex items-center justify-between mb-4">
            <div class="text-sm text-gray-500">
              <%= @trip.start_date.strftime("%B %d, %Y") %> - <%= @trip.end_date.strftime("%B %d, %Y") %>
            </div>
            <div class="text-sm text-gray-500">
              <%= pluralize((@trip.end_date - @trip.start_date).to_i + 1, "day") %>
            </div>
          </div>

          <!-- Timeline Bar -->
          <div class="relative bg-gray-200 rounded-full h-3 mb-4">
            <div class="absolute inset-0 bg-blue-500 rounded-full"></div>
            
            <!-- Day Markers -->
            <div class="absolute inset-0 flex items-center">
              <% (@trip.start_date..@trip.end_date).each_with_index do |date, index| %>
                <% 
                  total_days = (@trip.end_date - @trip.start_date).to_i + 1
                  position_percent = (index.to_f / (total_days - 1)) * 100
                  is_selected = date == @selected_date
                  has_events = @trip_events.any? { |event| date >= event.start_date && date <= event.end_date }
                %>
                <div class="absolute transform -translate-x-1/2" style="left: <%= position_percent %>%">
                  <%= link_to timeline_trip_path(@trip, date: date), 
                      class: "block w-4 h-4 rounded-full border-2 border-white #{is_selected ? 'bg-blue-700' : has_events ? 'bg-orange-500' : 'bg-gray-400'} hover:scale-110 transition-transform",
                      title: "#{date.strftime('%B %d')}#{has_events ? ' - Has Events' : ''}" do %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>

          <!-- Timeline Labels -->
          <div class="relative flex justify-between text-xs text-gray-500 mt-2">
            <div><%= @trip.start_date.strftime("%b %d") %></div>
            <div class="font-medium text-blue-600">
              <%= @selected_date.strftime("%B %d, %Y") %>
            </div>
            <div><%= @trip.end_date.strftime("%b %d") %></div>
          </div>
        </div>
      </div>

      <!-- Selected Day Events -->
      <div class="border-t pt-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-900">
            Events for <%= @selected_date.strftime("%B %d, %Y") %>
          </h3>
          <div class="text-sm text-gray-500">
            <%= pluralize(@selected_events.count, "event") %>
          </div>
        </div>

        <% if @selected_events.any? %>
          <div class="space-y-4">
            <% @selected_events.each do |event| %>
              <div class="bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h4 class="text-base font-medium text-gray-900">
                      <%= link_to event.title, trip_trip_event_path(@trip, event), class: "hover:text-blue-600" %>
                    </h4>
                    <div class="mt-1 text-sm text-gray-600">
                      <% if event.start_date == event.end_date %>
                        <%= event.start_date.strftime("%B %d, %Y") %>
                      <% else %>
                        <%= event.start_date.strftime("%B %d") %> - <%= event.end_date.strftime("%B %d, %Y") %>
                      <% end %>
                    </div>
                  </div>
                  <div class="flex items-center space-x-2">
                    <%= link_to trip_trip_event_path(@trip, event), 
                        class: "text-blue-600 hover:text-blue-800 transition-colors" do %>
                      <%= heroicon "eye", options: { class: "w-4 h-4" } %>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8">
            <div class="mx-auto h-12 w-12 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <%= heroicon "calendar", options: { class: "w-6 h-6 text-gray-400" } %>
            </div>
            <h3 class="text-sm font-medium text-gray-900 mb-1">No events for this day</h3>
            <p class="text-sm text-gray-500 mb-4">Add events to see them appear on the timeline</p>
            <%= link_to "Add Event", new_trip_trip_event_path(@trip), 
                class: "inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>